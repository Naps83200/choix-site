<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Redirection</title>
    <script>
    async function logAccess() {
        try {
            // Récupérer l'ID de la carte depuis l'URL
            const urlParams = new URLSearchParams(window.location.search);
            const tagId = urlParams.get('tagId');
            
            if (tagId) {
                // Charger le fichier de configuration des cartes
                const configResponse = await fetch('cards-config.json');
                const cardConfig = await configResponse.json();
                
                // Récupérer le nom du client associé à l'ID
                const clientName = cardConfig[tagId] || "Client inconnu";
                
                // Préparer les données pour l'email
                const emailData = {
                    to: "yolivier83@hotmail.fr",
                    subject: "Scan de carte NFC",
                    message: `Carte scannée : ${clientName} (ID: ${tagId})`,
                    timestamp: new Date().toLocaleString()
                };

                // URL de votre script Google Apps avec les paramètres
                const scriptUrl = 'https://script.google.com/macros/s/AKfycb2KpxVi8GVrSS_jdMNqCcMksSSyZXKJwE1y1EAGM6rPQheD8l5c/exec';
                const url = `${scriptUrl}?to=${encodeURIComponent(emailData.to)}&subject=${encodeURIComponent(emailData.subject)}&message=${encodeURIComponent(emailData.message)}`;

                // Envoyer la requête pour l'email
                await fetch(url, {
                    method: 'GET',
                    mode: 'no-cors'
                });

                console.log("Notification envoyée pour:", clientName);
                
                // Rediriger vers la page de choix après un court délai
                setTimeout(() => {
                    window.location.href = "index.html";
                }, 500);
            } else {
                console.log("Aucun ID détecté");
                document.getElementById('error-message').textContent = "Aucun ID de carte détecté";
            }
        } catch (error) {
            console.error("Erreur:", error);
            document.getElementById('error-message').textContent = "Erreur: " + error.message;
        }
    }
    </script>
</head>
<body onload="logAccess()">
    <div style="text-align: center; padding: 20px;">
        <p>Redirection en cours...</p>
        <div id="error-message" style="color: red;"></div>
    </div>
</body>
</html>
